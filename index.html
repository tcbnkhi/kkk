<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>å¤§å­¦åˆ¥ å˜èªãƒ†ã‚¹ãƒˆå…±æœ‰ã‚¢ãƒ—ãƒª</title>

<style>
body {
  font-family: sans-serif;
  max-width: 800px;
  margin: auto;
}
input, button {
  margin: 4px 0;
}
.test {
  border: 1px solid #ccc;
  padding: 10px;
  margin: 6px 0;
}
.tag {
  font-size: 0.9em;
  color: #0055aa;
  cursor: pointer;
  text-decoration: underline;
}
</style>
</head>

<body>

<h1>ğŸ“˜ å˜èªãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ã‚«ãƒ¼</h1>

<!-- å˜èªä½œæˆ -->
<h2>â‘  å˜èªã‚’ä½œã‚‹</h2>
<input id="word" placeholder="å˜èª">
<input id="meaning" placeholder="æ„å‘³">
<button onclick="addWord()">è¿½åŠ </button>

<div id="list"></div>

<!-- ãƒ†ã‚¹ãƒˆæƒ…å ± -->
<h2>â‘¡ ãƒ†ã‚¹ãƒˆæƒ…å ±</h2>
<input id="title" placeholder="ãƒ†ã‚¹ãƒˆåï¼ˆä¾‹ï¼šæœŸæœ«å¯¾ç­–ï¼‰"><br>
<input id="university" placeholder="å¤§å­¦åï¼ˆä¾‹ï¼šã€‡ã€‡å¤§å­¦ï¼‰"><br>
<input id="lecture" placeholder="ç§‘ç›®åï¼è¬›ç¾©åï¼ˆä¾‹ï¼šç¤¾ä¼šå­¦å…¥é–€ï¼‰"><br>

<button onclick="postTest()">æŠ•ç¨¿ã™ã‚‹</button>

<hr>

<!-- æ¤œç´¢ -->
<h2>ğŸ” ã‚¿ã‚°æ¤œç´¢</h2>
<input id="searchUniversity" placeholder="å¤§å­¦åã§æ¤œç´¢">
<input id="searchLecture" placeholder="è¬›ç¾©åã§æ¤œç´¢">
<button onclick="search()">æ¤œç´¢</button>
<button onclick="resetSearch()">ãƒªã‚»ãƒƒãƒˆ</button>

<hr>

<!-- æŠ•ç¨¿ä¸€è¦§ -->
<h2>ğŸ“š æŠ•ç¨¿ã•ã‚ŒãŸå˜èªãƒ†ã‚¹ãƒˆ</h2>
<div id="posts"></div>

<hr>

<!-- ãƒ†ã‚¹ãƒˆç”»é¢ -->
<h2 id="question"></h2>
<input id="answer" placeholder="ç­”ãˆ">
<button onclick="check()">ç­”ãˆã‚‹</button>
<p id="result"></p>

<script>
// ====== ãƒ‡ãƒ¼ã‚¿ ======
let words = [];
let index = 0;
let currentTest = null;

// ä¿å­˜æ¸ˆã¿æŠ•ç¨¿
const savedPosts = JSON.parse(localStorage.getItem("tests") || "[]");
renderPosts();

// ====== å˜èªä½œæˆ ======
function addWord() {
  if (!word.value || !meaning.value) return;
  words.push({ word: word.value, meaning: meaning.value });
  word.value = meaning.value = "";
  renderList();
}

function renderList() {
  list.innerHTML = "";
  words.forEach(w => {
    list.innerHTML += `<div>${w.word} - ${w.meaning}</div>`;
  });
}

// ====== æŠ•ç¨¿ ======
function postTest() {
  if (!title.value || !university.value || !lecture.value || words.length === 0) return;

  savedPosts.push({
    id: Date.now(),
    title: title.value,
    university: university.value,
    lecture: lecture.value,
    words: words
  });

  localStorage.setItem("tests", JSON.stringify(savedPosts));

  words = [];
  title.value = university.value = lecture.value = "";
  renderList();
  renderPosts();
}

// ====== æŠ•ç¨¿ä¸€è¦§ï¼ˆã‚¿ã‚°ã‚¯ãƒªãƒƒã‚¯å¯¾å¿œï¼‰ ======
function renderPosts(list = savedPosts) {
  posts.innerHTML = "";
  list.forEach(t => {
    posts.innerHTML += `
      <div class="test">
        <strong>${t.title}</strong><br>
        <span class="tag" onclick="clickUniversity('${t.university}')">
          ğŸ« ${t.university}
        </span><br>
        <span class="tag" onclick="clickLecture('${t.lecture}')">
          ğŸ“˜ ${t.lecture}
        </span><br>
        <button onclick="startTestById(${t.id})">ãƒ†ã‚¹ãƒˆé–‹å§‹</button>
      </div>
    `;
  });
}

// ====== ã‚¿ã‚°æ¤œç´¢ ======
function search() {
  const u = searchUniversity.value;
  const l = searchLecture.value;

  const filtered = savedPosts.filter(t =>
    t.university.includes(u) && t.lecture.includes(l)
  );

  renderPosts(filtered);
}

function resetSearch() {
  searchUniversity.value = "";
  searchLecture.value = "";
  renderPosts();
}

// ====== ã‚¿ã‚°ã‚¯ãƒªãƒƒã‚¯ ======
function clickUniversity(name) {
  searchUniversity.value = name;
  search();
}

function clickLecture(name) {
  searchLecture.value = name;
  search();
}

// ====== ãƒ†ã‚¹ãƒˆ ======
function startTestById(id) {
  currentTest = savedPosts.find(t => t.id === id);
  index = 0;
  result.textContent = "";
  showQuestion();
}

function showQuestion() {
  if (!currentTest || index >= currentTest.words.length) {
    question.textContent = "ãƒ†ã‚¹ãƒˆçµ‚äº†ï¼";
    return;
  }
  question.textContent = currentTest.words[index].word;
  answer.value = "";
}

function check() {
  if (!currentTest) return;

  if (answer.value === currentTest.words[index].meaning) {
    result.textContent = "æ­£è§£ï¼";
  } else {
    result.textContent = "ä¸æ­£è§£â€¦ æ­£è§£ï¼š" + currentTest.words[index].meaning;
  }
  index++;
  showQuestion();
}
</script>

</body>
</html>
